# MonoDB Server Configuration

# Server Configuration

[server]
# Host address to bind the server to.
# Set to "0.0.0.0" to accept connections from any interface.
# Env: MDB_HOST
host = "127.0.0.1"

# TCP port for the server.
# Env: MDB_PORT
port = 6432

# Maximum number of concurrent client connections.
# Higher values consume more memory but allow more concurrent users.
# Not currently enforced.
# max_connections = 1000

# [server.tls]
# Path to TLS certificate file (PEM format).
# cert_path = "path/to/cert.pem"

# Path to TLS private key file (PEM format).
# key_path = "path/to/key.pem"

# Storage Configuration

[storage]
# Path where database files are stored.
# The directory is created if it doesn't exist.
# Use a fast local SSD for best performance.
# Env: MDB_DATA_DIR
data_dir = "./data"

# Buffer pool size (pages) for storage.
# Memory used ≈ buffer_pool_size x page_size.
# With the default 16KB pages, 1000 pages ≈ 16MB.
buffer_pool_size = 1000

# Page size in bytes (for B-tree engine)
# Default: 16384 (16KB)
# Must be power of 2, typically 4KB, 8KB, 16KB, or 32KB
# Larger pages reduce I/O but use more memory
page_size = 16384

# Write-ahead log (WAL) configuration
[storage.wal]
# WAL buffer size (bytes) for write batching.
buffer_size = 65536  # 64 KiB

# Maximum WAL size (bytes) before rotation.
max_size = 67108864  # 64 MiB

# Sync changes to disk using the thresholds below.
# Keep this enabled for durability.
sync_on_write = true

# Background WAL writer (non-blocking appends).
# Leave enabled for better parallel write throughput.
async_write = false

# Group-commit thresholds:
# - Sync after this many bytes appended to the WAL.
# sync_every_bytes = 1048576  # 1 MiB
# - Ensure a sync at least this often (milliseconds), even if the byte threshold is not hit.
# sync_interval_ms = 1000  # 1 second

# Periodic checkpointing
[storage.checkpoint]
# Enable/disable periodic checkpoints.
enabled = true

# Checkpoint interval in milliseconds.
interval_ms = 30000

# Truncate WAL after a successful checkpoint (only when safe).
truncate_wal = true

# Authentication configuration
[auth]
# Enable/disable authentication (default: false)
# When disabled, all connections have root-level permissions.
# When enabled, clients must authenticate to execute queries.
enabled = false

# Session token expiry time in seconds (default: 86400 = 24 hours)
# Tokens are used for session resumption after password authentication.
token_expiry_secs = 86400

# Plugin system configuration
[plugins]
# Enable/disable plugins
enabled = true

# Directory containing plugin .wasm files
plugins_dir = "./data/plugins"

# Hot-reload plugins on change
hot_reload = true

# Maximum memory per plugin in bytes (128 MiB)
max_memory = 134217728

# Default fuel limit per plugin execution
default_fuel = 100000000

# Maximum fuel limit a plugin can request
max_fuel = 1000000000

# Default epoch deadline for plugins
default_deadline = 4

# Maximum epoch deadline for plugins
max_deadline = 16
